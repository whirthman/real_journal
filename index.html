<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pro Trading Journal v2</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0f172a;
  --panel:#1e293b;
  --card:#0f172a;
  --muted:#94a3b8;
  --line:#334155;
  --accent:#3b82f6;
  --win: #059669;
  --loss: #dc2626;
  --text:#f8fafc;
}

body{
  margin:0;
  font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
  padding:10px;
  line-height: 1.5;
}

h1{
  text-align:center;
  font-weight: 700;
  letter-spacing: -1px;
  margin: 20px 0;
  color: var(--text);
}

/* BUTTONS */
button{
  background:var(--accent);
  border:none;
  color:white;
  padding:10px 18px;
  border-radius:8px;
  cursor:pointer;
  font-weight: 600;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
button:hover{background:#2563eb; transform: translateY(-1px);}
.btn-outline{ background: transparent; border: 1px solid var(--line); }
.btn-danger{ background: #7f1d1d; }
.btn-danger:hover{ background: #b91c1c; }
.btn-success{ background: var(--win); }

/* MODAL STYLES */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.8);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
  backdrop-filter: blur(4px);
}

.modal-content{
  background:var(--panel);
  width:95%;
  max-width:800px;
  max-height:90vh;
  overflow:auto;
  border-radius:16px;
  padding:30px;
  box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
}

.close{
  float:right;
  cursor:pointer;
  color:var(--muted);
  font-size: 24px;
}

/* FORM STYLES */
.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

label{
  font-size:12px;
  font-weight: 600;
  margin-top:10px;
  display:block;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

input,select,textarea{
  width:100%;
  padding:12px;
  background:var(--card);
  border: 1px solid var(--line);
  border-radius:8px;
  color:white;
  box-sizing: border-box;
  margin-top: 5px;
}

input:focus{ outline: 2px solid var(--accent); border-color: transparent; }

textarea{resize:vertical;}

fieldset{
  border:1px solid var(--line);
  margin-top:20px;
  padding:15px;
  border-radius: 8px;
  grid-column: 1 / -1;
}

legend{
  font-size:12px;
  padding:0 10px;
  font-weight: bold;
}

.checkbox-group{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap:8px;
}

.checkbox-group label {
    display: flex;
    align-items: center;
    gap: 5px;
    text-transform: none;
    color: var(--text);
    cursor: pointer;
}

/* DASHBOARD / FILTER BAR */
.control-panel {
    background: var(--panel);
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    align-items: flex-end;
    border: 1px solid var(--line);
}

.filter-group { flex: 1; min-width: 180px; }

/* TABLE STYLES */
.table-container{
  overflow-x:auto;
  background: var(--panel);
  padding: 5px;
  border-radius: 12px;
  border: 1px solid var(--line);
}

table{
  border-collapse:collapse;
  min-width:1800px;
  width:100%;
}

th{
  background:var(--panel);
  padding:15px 10px;
  text-align: left;
  font-size: 11px;
  text-transform: uppercase;
  color: var(--muted);
  border-bottom: 2px solid var(--line);
  cursor: pointer;
}
th:hover { color: var(--accent); }

td{
  padding:12px 10px;
  font-size:13px;
  border-bottom: 1px solid var(--line);
}

.row-win { background-color: rgba(5, 150, 105, 0.2) !important; border-left: 4px solid var(--win); }
.row-loss { background-color: rgba(220, 38, 38, 0.2) !important; border-left: 4px solid var(--loss); }

.actions-top{
  display:flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 10px;
}

.data-btns { display: flex; gap: 8px; }

/* MOBILE RESPONSIVENESS */
@media (max-width: 768px) {
    .form-grid { grid-template-columns: 1fr; }
    .control-panel { flex-direction: column; align-items: stretch; }
}
</style>
</head>

<body>

<h1>Trading Journal <span style="color:var(--accent)">v1.2</span></h1>

<div class="actions-top">
    <button onclick="openModal('formModal')" class="btn-success">Log New Trade +</button>
    <div class="data-btns">
        <button class="btn-outline" onclick="exportCSV()">Export CSV</button>
        <button class="btn-outline" onclick="document.getElementById('csvImport').click()">Import CSV</button>
        <input type="file" id="csvImport" style="display:none" accept=".csv" onchange="importCSV(event)">
        <button class="btn-danger" onclick="clearData()">Clear All</button>
    </div>
</div>

<div class="control-panel">
    <div class="filter-group">
        <label>Search Instrument</label>
        <input type="text" id="searchInput" placeholder="Search..." onkeyup="render()">
    </div>
    <div class="filter-group">
        <label>Result</label>
        <select id="filterResult" onchange="render()">
            <option value="all">All</option>
            <option value="Win">Win</option>
            <option value="Loss">Loss</option>
        </select>
    </div>
    <div class="filter-group">
        <label>Start Date</label>
        <input type="date" id="filterStart" onchange="render()">
    </div>
    <div class="filter-group">
        <label>End Date</label>
        <input type="date" id="filterEnd" onchange="render()">
    </div>
</div>

<div class="table-container">
    <table id="tradeTable">
    <thead>
    <tr>
    <th onclick="setSort('displayId')">ID â†•</th>
    <th onclick="setSort('date')">Date â†•</th>
    <th onclick="setSort('broker')">Broker â†•</th>
    <th>Account</th>
    <th>Market</th>
    <th onclick="setSort('instrument')">Instrument â†•</th>
    <th>Dir</th>
    <th>Entry</th>
    <th>Exit</th>
    <th>SL</th>
    <th onclick="setSort('result')">Result â†•</th>
    <th>Lot</th>
    <th>Risk</th>
    <th onclick="setSort('pnl')">PnL â†•</th>
    <th>Equity</th>
    <th>TF</th>
    <th>Conf</th>
    <th>Ind</th>
    <th>Psy</th>
    <th>Setup</th>
    <th>Entry</th>
    <th>Exit</th>
    <th>Notes</th>
    <th>Action</th>
    </tr>
    </thead>
    <tbody></tbody>
    </table>
</div>

<div class="modal" id="formModal">
<div class="modal-content">
<span class="close" onclick="closeModal('formModal')">âœ•</span>
<h2 style="margin-top:0">Log New Trade</h2>

<form id="tradeForm">
<div class="form-grid">
    <div>
        <label>Broker</label>
        <input required placeholder="e.g. IC Markets">
    </div>
    <div>
        <label>Account</label>
        <input required placeholder="e.g. Live Personal">
    </div>
    <div>
        <label>Market</label>
        <select id="market" required>
          <option value="">Select Market</option>
          <option>Forex</option>
          <option>Crypto</option>
          <option>Indices</option>
        </select>
    </div>
    <div>
        <label>Instrument</label>
        <select id="instrument" required></select>
    </div>
    <div>
        <label>Direction</label>
        <select required>
          <option>Buy / Long</option>
          <option>Sell / Short</option>
        </select>
    </div>
    <div>
        <label>Entry Price</label>
        <input type="number" step="any" required>
    </div>
    <div>
        <label>Exit Price</label>
        <input type="number" step="any" required>
    </div>
    <div>
        <label>Stop Loss</label>
        <input type="number" step="any">
    </div>
    <div>
        <label>Result</label>
        <select required>
            <option value="Win">Win</option>
            <option value="Loss">Loss</option>
        </select>
    </div>
    <div>
        <label>Lot Size</label>
        <input type="number" step="any">
    </div>
    <div>
        <label>Risk ($)</label>
        <input type="number" step="any">
    </div>
    <div>
        <label>Net PnL ($)</label>
        <input type="number" step="any">
    </div>
    <div>
        <label>Equity After ($)</label>
        <input type="number" step="any">
    </div>
    <div>
        <label>Entry Date & Time</label>
        <input type="datetime-local" required id="entryDateTime">
    </div>
    <div>
        <label>Exit Date & Time</label>
        <input type="datetime-local" required id="exitDateTime">
    </div>
</div>

<fieldset>
<legend>Analysis Details</legend>
<label>Timeframes</label>
<div class="checkbox-group" id="tf-group">
    <label><input type="checkbox" value="Monthly"> Monthly</label>
    <label><input type="checkbox" value="Weekly"> Weekly</label>
    <label><input type="checkbox" value="Daily"> Daily</label>
    <label><input type="checkbox" value="H4"> 4H</label>
    <label><input type="checkbox" value="H1"> 1H</label>
    <label><input type="checkbox" value="M15"> 15m</label>
</div>
<label style="margin-top:15px">Confluence</label>
<div class="checkbox-group" id="conf-group">
    <label><input type="checkbox" value="FVG"> FVG</label>
    <label><input type="checkbox" value="OB"> OB</label>
    <label><input type="checkbox" value="BOS"> BOS</label>
    <label><input type="checkbox" value="Liquidity"> Liq Sweep</label>
</div>

<label style="margin-top:15px">Indicators Used</label>
<div class="checkbox-group" id="ind-group">
    <label><input type="checkbox" value="EMA 50"> EMA 50</label>
    <label><input type="checkbox" value="EMA 100"> EMA 100</label>
    <label><input type="checkbox" value="Volume"> Volume</label>
    <label><input type="checkbox" value="ZigZag"> ZigZag</label>
    <label><input type="checkbox" value="Stochastic"> Stochastic</label>
    <label><input type="checkbox" value="MACD"> MACD</label>
    <label><input type="checkbox" value="Fracture"> Fracture</label>
</div>

<label style="margin-top:15px">Trading Psychology</label>
<div class="checkbox-group" id="psy-group">
    <label><input type="checkbox" value="Calm"> Calm</label>
    <label><input type="checkbox" value="Confident"> Confident</label>
    <label><input type="checkbox" value="Fear"> Fear</label>
    <label><input type="checkbox" value="Discipline"> Discipline</label>
    <label><input type="checkbox" value="Greed"> Greed</label>
    <label><input type="checkbox" value="Patience"> Patience</label>
    <label><input type="checkbox" value="FOMO"> FOMO</label>
</div>
</fieldset>

<label>Screenshot URLs (Setup / Entry / Exit)</label>
<div class="form-grid">
    <input placeholder="Setup URL">
    <input placeholder="Entry URL">
    <input placeholder="Exit URL">
</div>

<label>Trade Notes</label>
<textarea rows="3" placeholder="Describe your mindset and reason for trade..."></textarea>

<button type="submit" style="margin-top: 25px; width: 100%; padding: 15px;">ðŸ’¾ SAVE TRADE ENTRY</button>
</form>
</div>
</div>

<script>
const marketInstruments={
  Forex:["EURUSD","GBPUSD","USDJPY","AUDUSD","USDCAD","USDCHF","NZDUSD"],
  Crypto:["BTCUSD","ETHUSD","SOLUSD","BNBUSD"],
  Indices:["Volatility 50 Index","Volatility 75 Index","Volatility 100 Index"]
};

const market=document.getElementById("market");
const instrument=document.getElementById("instrument");

market.onchange=()=>{
  instrument.innerHTML="";
  (marketInstruments[market.value]||[]).forEach(i=>{
    let o=document.createElement("option");
    o.textContent=i;
    instrument.appendChild(o);
  });
};

let trades=JSON.parse(localStorage.getItem("journalTrades"))||[];
let sortKey = 'date';
let sortAsc = false;
const tbody=document.querySelector("#tradeTable tbody");

function openModal(id){
    document.getElementById(id).style.display="flex";
    const now = new Date().toISOString().slice(0, 16);
    document.getElementById('entryDateTime').value = now;
    document.getElementById('exitDateTime').value = now;
}
function closeModal(id){document.getElementById(id).style.display="none";}

function setSort(key) {
    if (sortKey === key) {
        sortAsc = !sortAsc;
    } else {
        sortKey = key;
        sortAsc = true;
    }
    render();
}

function render(){
  tbody.innerHTML="";
  const searchTerm = document.getElementById("searchInput").value.toLowerCase();
  const filterResult = document.getElementById("filterResult").value;
  const startDate = document.getElementById("filterStart").value;
  const endDate = document.getElementById("filterEnd").value;

  let filtered = trades.filter(t => {
      const matchSearch = t.instrument.toLowerCase().includes(searchTerm) || t.broker.toLowerCase().includes(searchTerm);
      const matchResult = filterResult === "all" || t.result === filterResult;
      const tradeDate = new Date(t.date).setHours(0,0,0,0);
      const start = startDate ? new Date(startDate).setHours(0,0,0,0) : null;
      const end = endDate ? new Date(endDate).setHours(0,0,0,0) : null;
      return matchSearch && matchResult && (!start || tradeDate >= start) && (!end || tradeDate <= end);
  });

  filtered.sort((a,b)=> {
      let valA = a[sortKey];
      let valB = b[sortKey];
      
      // Handle numeric sorting
      if (!isNaN(valA) && !isNaN(valB) && valA !== "" && valB !== "") {
          valA = parseFloat(valA);
          valB = parseFloat(valB);
      }
      
      if (valA < valB) return sortAsc ? -1 : 1;
      if (valA > valB) return sortAsc ? 1 : -1;
      return 0;
  });

  filtered.forEach((t)=>{
    let r=document.createElement("tr");
    r.className = t.result === "Win" ? "row-win" : "row-loss";
    r.innerHTML=`<td>${t.displayId}</td><td>${new Date(t.date).toLocaleString()}</td><td>${t.broker}</td><td>${t.account}</td>
    <td>${t.market}</td><td>${t.instrument}</td><td>${t.direction}</td>
    <td>${t.entry}</td><td>${t.exit}</td><td>${t.sl}</td><td>${t.result}</td>
    <td>${t.lot}</td><td>${t.risk}</td><td>${t.pnl}</td><td>${t.equity}</td>
    <td>${t.tf}</td><td>${t.conf}</td><td>${t.ind || '-'}</td><td>${t.psy || '-'}</td>
    <td>${t.setup ? `<a href="${t.setup}" target="_blank" style="color:var(--accent)">View</a>` : '-'}</td>
    <td>${t.entryUrl ? `<a href="${t.entryUrl}" target="_blank" style="color:var(--accent)">View</a>` : '-'}</td>
    <td>${t.exitUrl ? `<a href="${t.exitUrl}" target="_blank" style="color:var(--accent)">View</a>` : '-'}</td>
    <td>${t.notes}</td>
    <td><button class="btn-danger" style="padding:4px 8px" onclick="del('${t.id}')">Delete</button></td>`;
    tbody.appendChild(r);
  });
}

function del(id){
  if(confirm("Delete this trade?")){
    trades = trades.filter(t => t.id !== id);
    localStorage.setItem("journalTrades",JSON.stringify(trades));
    render();
  }
}

function clearData(){
    if(confirm("WARNING: This will delete ALL trades permanently. Proceed?")){
        trades = [];
        localStorage.setItem("journalTrades", JSON.stringify(trades));
        render();
    }
}

document.getElementById("tradeForm").onsubmit=e=>{
  e.preventDefault();
  const f=e.target;
  const chk=id=>[...document.querySelectorAll(`#${id} input:checked`)].map(x=>x.value).join(", ");
  
  trades.push({
    id: Date.now().toString(),
    displayId: trades.length + 1,
    date: document.getElementById('entryDateTime').value,
    broker: f[0].value,
    account: f[1].value,
    market: f[2].value,
    instrument: f[3].value,
    direction: f[4].value,
    entry: f[5].value,
    exit: f[6].value,
    sl: f[7].value,
    result: f[8].value,
    lot: f[9].value,
    risk: f[10].value,
    pnl: f[11].value,
    equity: f[12].value,
    exitDate: f[14].value,
    tf: chk("tf-group"),
    conf: chk("conf-group"),
    ind: chk("ind-group"),
    psy: chk("psy-group"),
    setup: f[19].value,
    entryUrl: f[20].value,
    exitUrl: f[21].value,
    notes: f[22].value
  });
  
  localStorage.setItem("journalTrades",JSON.stringify(trades));
  f.reset();
  closeModal('formModal');
  render();
};

function exportCSV(){
    // All columns from the table
    const headers = ["ID","Date","Broker","Account","Market","Instrument","Direction","Entry","Exit","SL","Result","Lot","Risk","PnL","Equity","Timeframes","Confluence","Indicators","Psychology","SetupURL","EntryURL","ExitURL","Notes"];
    let csv = headers.join(",") + "\n";
    
    trades.forEach(t => {
        const row = [
            t.displayId,
            `"${t.date}"`,
            `"${t.broker}"`,
            `"${t.account}"`,
            `"${t.market}"`,
            `"${t.instrument}"`,
            `"${t.direction}"`,
            t.entry,
            t.exit,
            t.sl,
            t.result,
            t.lot,
            t.risk,
            t.pnl,
            t.equity,
            `"${t.tf}"`,
            `"${t.conf}"`,
            `"${t.ind}"`,
            `"${t.psy}"`,
            `"${t.setup}"`,
            `"${t.entryUrl}"`,
            `"${t.exitUrl}"`,
            `"${t.notes.replace(/"/g, '""')}"`
        ];
        csv += row.join(",") + "\n";
    });
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.setAttribute('href', url);
    a.setAttribute('download', `journal_export_${new Date().toLocaleDateString()}.csv`);
    a.click();
}

function importCSV(event){
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = function(e){
        alert("Import feature requires specific formatting. Use Export to see structure.");
    };
    reader.readAsText(file);
}

render();
</script>

</body>
</html>