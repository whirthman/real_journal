<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Compounding Calculator</title>

<style>
:root {
  --bg: #0e1117;
  --card: #161b22;
  --accent: #22c55e;
  --danger: #ef4444;
  --text: #e5e7eb;
  --muted: #9ca3af;
  --border: #262c36;
}

* {
  box-sizing: border-box;
  font-family: "Inter", system-ui, -apple-system, sans-serif;
}

body {
  margin: 0;
  min-height: 100vh;
  background: linear-gradient(135deg, #0e1117, #020617);
  color: var(--text);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.app {
  width: 100%;
  max-width: 720px;
}

.header {
  text-align: center;
  margin-bottom: 24px;
}

.header h1 {
  margin: 0;
  font-size: 1.8rem;
  font-weight: 700;
}

.header p {
  margin-top: 6px;
  color: var(--muted);
  font-size: 0.95rem;
}

.card {
  background: var(--card);
  border-radius: 14px;
  padding: 22px;
  border: 1px solid var(--border);
  box-shadow: 0 20px 40px rgba(0,0,0,0.4);
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(150px,1fr));
  gap: 12px;
  margin-bottom: 12px;
}

.form-group {
  margin-bottom: 16px;
}

label {
  display: block;
  font-size: 0.85rem;
  margin-bottom: 6px;
  color: var(--muted);
}

input {
  width: 100%;
  padding: 10px 12px;
  background: #020617;
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text);
  font-size: 1rem;
}

input:focus {
  outline: none;
  border-color: var(--accent);
}

button {
  width: 100%;
  padding: 12px;
  background: linear-gradient(135deg, #16a34a, #22c55e);
  color: #022c22;
  font-size: 1rem;
  font-weight: 700;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  margin-top: 10px;
}

.small-btn {
  padding: 8px 12px;
  border-radius: 8px;
  font-weight: 600;
  margin-right: 8px;
  background: #111827;
  color: var(--text);
  border: 1px solid var(--border);
  cursor: pointer;
}

.small-btn:hover { opacity: .95; }

.result-card {
  margin-top: 22px;
  padding: 20px;
  border-radius: 14px;
  background: #020617;
  border: 1px solid var(--border);
  display: none;
}

/* sequence/projection table styles */
.table-wrap {
  margin-top: 12px;
  overflow-x: auto;
  border-radius: 8px;
  border: 1px solid #222;
}
.table {
  width: 100%;
  border-collapse: collapse;
  min-width: 640px;
}
.table th, .table td {
  padding: 8px 10px;
  border-bottom: 1px solid #222;
  text-align: left;
  font-size: 0.95rem;
  color: var(--text);
}
.table thead th {
  position: sticky;
  top: 0;
  background: rgba(10,13,18,0.9);
  z-index: 2;
}
.controls-row {
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top: 12px;
  align-items:center;
}

/* layout rows in result card */
.result-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
}
.result-row:last-child {
  margin-bottom: 0;
}

.result-label {
  color: var(--muted);
  font-size: 0.9rem;
}

.result-value {
  font-weight: 600;
}

.final {
  color: var(--accent);
  font-size: 1.1rem;
}

@media (max-width: 480px) {
  .header h1 {
    font-size: 1.5rem;
  }
  .result-row { flex-direction: column; gap:6px; align-items:flex-start; }
  .form-grid { grid-template-columns: 1fr; }
  .table { min-width: 480px; }
}
</style>
</head>

<body>

<div class="app">
  <div class="header">
    <h1>Compounding Calculator</h1>
    <p>Exponential growth made simple â€” view detailed projections</p>
  </div>

  <div class="card">
    <div class="form-grid">
      <div class="form-group">
        <label>Starting Equity ($)</label>
        <input type="number" id="equity" placeholder="e.g. 100" min="0" step="0.01">
      </div>

      <div class="form-group">
        <label>Target Daily Profit (%)</label>
        <input type="number" id="dailyProfit" placeholder="e.g. 3" min="0" step="0.01">
      </div>

      <div class="form-group">
        <label>Compounding Days</label>
        <input type="number" id="days" placeholder="e.g. 30" min="1">
      </div>

      <!-- new inputs for projection/winrate -->
      <div class="form-group">
        <label>Risk per Trade (%)</label>
        <input type="number" id="riskPerTrade" placeholder="e.g. 1" min="0.01" step="0.01" value="1">
      </div>

      <div class="form-group">
        <label>Trades per Day</label>
        <input type="number" id="tradesPerDay" placeholder="e.g. 1" min="1" step="1" value="1">
      </div>

      <div class="form-group">
        <label>Sample R:R (for projection)</label>
        <input type="number" id="rrSample" placeholder="e.g. 2" min="0.01" step="0.01" value="2">
      </div>
    </div>

    <button onclick="calculate()">Calculate Growth</button>

    <div class="result-card" id="resultCard">
      <div class="result-row">
        <span class="result-label">Starting Equity</span>
        <span class="result-value" id="startEquity">$0.00</span>
      </div>

      <div class="result-row">
        <span class="result-label">Final Equity</span>
        <span class="result-value final" id="finalEquity">$0.00</span>
      </div>

      <div class="result-row">
        <span class="result-label">Total Profit</span>
        <span class="result-value" id="totalProfit">$0.00</span>
      </div>

      <div class="result-row">
        <span class="result-label">Growth (%)</span>
        <span class="result-value" id="growthPercent">0%</span>
      </div>

      <div class="controls-row">
        <button class="small-btn" id="showDays">Show Days</button>
        <button class="small-btn" id="showWeeks">Show Weeks</button>
        <button class="small-btn" id="showMonths">Show Months</button>
        <button class="small-btn" id="showRR">Winrate Projection (R:R table)</button>
        <div style="flex:1"></div>
        <button class="small-btn" id="exportCsv" title="Export sequence to CSV">Export CSV</button>
      </div>

      <div id="sequenceContainer" class="table-wrap" style="display:none; margin-top:12px;">
        <table class="table" id="sequenceTable">
          <thead><tr><th>Period</th><th>Start Equity</th><th>Profit</th><th>End Equity</th><th>Daily %</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="projectionContainer" class="table-wrap" style="display:none; margin-top:12px;">
        <table class="table" id="projectionTable">
          <thead><tr><th>R:R</th><th>Risk %</th><th>Trades/Day</th><th>Required Winrate (%)</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
/* helper */
function fmt(n,dec=2){ return typeof n === 'number' ? n.toLocaleString(undefined,{minimumFractionDigits:dec, maximumFractionDigits:dec}) : n; }

function calculate() {
  const equity = parseFloat(document.getElementById("equity").value);
  const daily = parseFloat(document.getElementById("dailyProfit").value);
  const days = parseInt(document.getElementById("days").value,10);

  if (isNaN(equity) || isNaN(daily) || isNaN(days) || days < 1) {
    alert("Please fill in all fields correctly.");
    return;
  }

  let finalEquity = equity;
  const sequence = [];
  // daily compounding sequence
  for (let i = 1; i <= days; i++) {
    const start = finalEquity;
    const profit = start * (daily / 100);
    finalEquity = start + profit;
    sequence.push({ period: i, start, profit, end: finalEquity, percent: daily });
  }

  const profit = finalEquity - equity;
  const growth = (profit / equity) * 100;

  document.getElementById("startEquity").textContent = `$${fmt(equity,2)}`;
  document.getElementById("finalEquity").textContent = `$${fmt(finalEquity,2)}`;
  document.getElementById("totalProfit").textContent = `$${fmt(profit,2)}`;
  document.getElementById("growthPercent").textContent = `${growth.toFixed(2)}%`;

  // store last calculation for sequence export / rendering
  window._lastCalc = { equity, daily, days, sequence };

  document.getElementById("resultCard").style.display = "block";
  // show compact days table by default
  renderSequence('days');
  showSequenceContainer();
  hideProjectionContainer();
}

/* renderers */
function showSequenceContainer(){ document.getElementById('sequenceContainer').style.display = 'block'; }
function hideSequenceContainer(){ document.getElementById('sequenceContainer').style.display = 'none'; }
function showProjectionContainer(){ document.getElementById('projectionContainer').style.display = 'block'; }
function hideProjectionContainer(){ document.getElementById('projectionContainer').style.display = 'none'; }

function renderSequence(mode='days'){
  const last = window._lastCalc;
  if(!last){ alert('Run calculation first'); return; }
  const tbody = document.querySelector('#sequenceTable tbody');
  tbody.innerHTML = '';
  if(mode === 'days'){
    last.sequence.forEach(item=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>Day ${item.period}</td>
                      <td>$${fmt(item.start,2)}</td>
                      <td>$${fmt(item.profit,2)}</td>
                      <td>$${fmt(item.end,2)}</td>
                      <td>${fmt(item.percent,2)}%</td>`;
      tbody.appendChild(tr);
    });
  } else if(mode === 'weeks'){
    // aggregate every 7 days
    const weeks = [];
    for(let i=0;i<last.sequence.length;i+=7){
      const slice = last.sequence.slice(i,i+7);
      const start = slice[0].start;
      const end = slice[slice.length-1].end;
      const profit = end - start;
      const period = `Week ${Math.floor(i/7)+1}`;
      const avgPercent = slice.reduce((s,it)=>s+it.percent,0)/slice.length;
      weeks.push({period, start, profit, end, percent: avgPercent});
    }
    weeks.forEach(w=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${w.period}</td>
                      <td>$${fmt(w.start,2)}</td>
                      <td>$${fmt(w.profit,2)}</td>
                      <td>$${fmt(w.end,2)}</td>
                      <td>${fmt(w.percent,2)}%</td>`;
      tbody.appendChild(tr);
    });
  } else if(mode === 'months'){
    // aggregate every 30 days
    const months = [];
    for(let i=0;i<last.sequence.length;i+=30){
      const slice = last.sequence.slice(i,i+30);
      const start = slice[0].start;
      const end = slice[slice.length-1].end;
      const profit = end - start;
      const period = `Month ${Math.floor(i/30)+1}`;
      const avgPercent = slice.reduce((s,it)=>s+it.percent,0)/slice.length;
      months.push({period, start, profit, end, percent: avgPercent});
    }
    months.forEach(m=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${m.period}</td>
                      <td>$${fmt(m.start,2)}</td>
                      <td>$${fmt(m.profit,2)}</td>
                      <td>$${fmt(m.end,2)}</td>
                      <td>${fmt(m.percent,2)}%</td>`;
      tbody.appendChild(tr);
    });
  }
}

/* projection: required winrate given R:R, risk%, trades/day to achieve target daily % */
function renderProjection(){
  const rrBase = parseFloat(document.getElementById('rrSample').value) || 2;
  const riskPerTrade = parseFloat(document.getElementById('riskPerTrade').value) || 1;
  const tradesPerDay = parseInt(document.getElementById('tradesPerDay').value,10) || 1;
  const dailyTarget = parseFloat(document.getElementById('dailyProfit').value);
  if(isNaN(dailyTarget) || dailyTarget <= 0){
    alert('Set a target daily profit first.');
    return;
  }

  // expectation per trade required (in risk-units)
  // expectation * (risk% of equity) * tradesPerDay = dailyTarget%
  const riskFraction = riskPerTrade/100;
  const requiredExpectation = (dailyTarget/100) / (riskFraction * tradesPerDay); // in R-units
  // required winrate for a given RR: win*(RR) - (1-win)*1 = expectation -> win*(RR+1) -1 = exp -> win = (exp+1)/(RR+1)
  // We'll produce table across RR variations around rrBase
  const tbody = document.querySelector('#projectionTable tbody');
  tbody.innerHTML = '';
  const rrList = [];
  // generate list: 0.5 to 5 step 0.5, but ensure rrBase included
  for(let r=0.5; r<=5.0; r+=0.5) rrList.push(Number(r.toFixed(2)));
  if(!rrList.includes(rrBase)) rrList.push(rrBase);
  rrList.sort((a,b)=>a-b);

  rrList.forEach(rr=>{
    const reqWin = (requiredExpectation + 1) / (rr + 1);
    const reqWinPct = Math.max(0, Math.min(1, reqWin)) * 100;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${rr.toFixed(2)} : 1</td>
                    <td>${fmt(riskPerTrade,2)}%</td>
                    <td>${tradesPerDay}</td>
                    <td>${fmt(reqWinPct,2)}%</td>`;
    tbody.appendChild(tr);
  });
}

/* UI wiring */
document.getElementById('showDays').addEventListener('click', ()=>{
  renderSequence('days'); hideProjectionContainer(); showSequenceContainer();
});
document.getElementById('showWeeks').addEventListener('click', ()=>{
  renderSequence('weeks'); hideProjectionContainer(); showSequenceContainer();
});
document.getElementById('showMonths').addEventListener('click', ()=>{
  renderSequence('months'); hideProjectionContainer(); showSequenceContainer();
});
document.getElementById('showRR').addEventListener('click', ()=>{
  renderProjection(); hideSequenceContainer(); showProjectionContainer();
});

document.getElementById('exportCsv').addEventListener('click', ()=>{
  const last = window._lastCalc;
  if(!last){ alert('Run calculation first'); return; }
  // default export days
  const rows = [['Period','Start','Profit','End','Daily%']];
  last.sequence.forEach(s=> rows.push([`Day ${s.period}`, s.start.toFixed(2), s.profit.toFixed(2), s.end.toFixed(2), s.percent.toFixed(4)]));
  const csv = rows.map(r=> r.map(c=> `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv], {type: 'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `compound_sequence_${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
  URL.revokeObjectURL(url);
});
</script>

</body>
</html>